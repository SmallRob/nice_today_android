# 移动端文件访问功能 - 快速开始指南

## 功能概述

现在应用支持在Android和iOS的WebView中进行文件保存和导入，实现以下功能：

- ✅ 导出配置到设备存储
- ✅ 从设备导入配置文件
- ✅ 创建完整数据备份
- ✅ 恢复历史备份数据
- ✅ 自动处理存储权限
- ✅ 多平台兼容（原生应用、浏览器）

## 快速使用

### 场景1：导出用户配置

1. **进入用户配置管理页面**
   - 点击底部导航栏"更多"
   - 选择"用户配置"

2. **导出配置**
   - 找到"用户数据管理"区域
   - 点击"导出用户配置"按钮
   - **Android/iOS WebView**: 应用会请求存储权限，点击"允许"
   - 选择保存位置（或自动保存到默认位置）
   - 等待"配置导出成功"提示

### 场景2：导入用户配置

1. **准备配置文件**
   - 确保已有有效的配置文件（.json格式）

2. **导入配置**
   - 在用户配置管理页面
   - 点击"导入用户配置"按钮
   - **首次使用**: 应用会请求存储权限，点击"允许"
   - 选择要导入的文件
   - 等待"导入配置成功"提示
   - 配置会自动加载到现有配置列表

### 场景3：创建数据备份（推荐）

1. **创建完整备份**
   - 在"用户数据管理"区域
   - 点击"创建备份"按钮
   - **首次使用**: 应用会请求存储权限，点击"允许"
   - 备份将包含：
     - 所有用户配置
     - 八字计算缓存
     - 应用设置（主题、语言等）
   - 等待"备份成功！数据大小: XX KB"提示

### 场景4：恢复数据备份

⚠️ **重要**: 恢复备份会覆盖当前所有数据，请谨慎操作！

1. **恢复前的准备**
   - 建议：先创建当前数据的备份
   - 确保备份文件完整有效

2. **恢复备份**
   - 点击"恢复备份"按钮
   - 选择之前创建的备份文件
   - 确认恢复操作
   - 等待"数据恢复成功"提示
   - 页面会自动刷新，恢复完成

### 场景5：更换设备迁移数据

#### 从旧设备导出
```
旧设备 → 用户配置 → 创建备份 → 保存到云盘/发送给自己
```

#### 在新设备导入
```
新设备 → 用户配置 → 恢复备份 → 选择备份文件 → 完成！
```

## 权限说明

### Android

#### 首次使用时的权限请求
- **提示**: "Nice Today需要访问您的文件"
- **选择**: "允许"
- **作用**: 保存文件到设备存储

#### 如果拒绝权限
- **现象**: 点击保存/导入按钮无响应或提示"存储权限不足"
- **解决**:
  1. 打开手机设置
  2. 找到"Nice Today"应用
  3. 权限 → 存储 → 选择"允许"
  4. 重新操作即可

### iOS

iOS不需要显式权限请求，文件会自动保存到应用Documents目录。

## 文件说明

### 配置文件 (.json)
- **命名格式**: `nice-today-configs-YYYY-MM-DD.json`
- **内容**: 仅包含用户配置信息
- **用途**: 分享配置给他人，或在多设备间同步配置

### 备份文件 (.json)
- **命名格式**: `nice-today-backup-YYYY-MM-DD.json`
- **内容**: 包含所有用户数据（配置+缓存+设置）
- **用途**: 完整数据备份，设备迁移

## 常见问题

### Q1: 导出后找不到文件？

**Android**:
- 文件通常保存在 `/Documents/` 目录
- 使用文件管理器应用搜索 "nice-today"
- 或者在应用内重新导出，查看提示信息

**iOS**:
- 文件保存在应用Documents目录
- 通过"文件"应用 → "在我的iPhone上" → 找到应用名称

### Q2: 导入失败？

可能原因：
1. 文件格式不正确（必须是.json格式）
2. 文件内容被修改或损坏
3. 文件不是由本应用导出的

解决方法：
- 重新导出配置/备份
- 确保文件未被编辑
- 使用最新版本的备份文件

### Q3: 权限被拒绝后怎么办？

**Android**:
1. 打开手机设置
2. 应用 → Nice Today → 权限
3. 找到"存储"或"文件访问"
4. 设置为"允许"
5. 重新操作

**iOS**:
- iOS通常不需要手动授予权限
- 如果出现问题，尝试重启应用

### Q4: 备份文件很大怎么办？

当前版本备份为JSON格式，如果数据量大：
- 定期清理缓存数据
- 删除不用的配置
- 删除过期的历史数据

未来版本将支持ZIP压缩，减小文件大小。

### Q5: 能否分享配置给朋友？

可以！
1. 导出配置（不是完整备份）
2. 通过微信、QQ等发送配置文件
3. 朋友导入该配置文件即可

⚠️ **注意**: 配置文件可能包含个人信息，请谨慎分享。

## 最佳实践

### 1. 定期备份
- 建议每周或每月创建一次完整备份
- 更换设备前务必备份
- 更新应用前建议备份

### 2. 备份命名
- 备份文件自动包含日期
- 可以重命名添加备注，如：`nice-today-backup-2025-12-29-搬家前.json`

### 3. 备份存储
- 推荐保存在云盘（百度网盘、Google Drive等）
- 或发送到自己的微信/QQ文件传输助手
- 避免仅保存在本地设备（设备丢失风险）

### 4. 数据安全
- 备份文件包含敏感信息，请妥善保管
- 不要在公共网络传输备份文件
- 定期删除过期的备份文件

## 功能对比

| 功能 | 配置导出 | 完整备份 |
|-----|---------|---------|
| 内容 | 仅配置信息 | 配置+缓存+设置 |
| 用途 | 分享配置 | 数据备份、设备迁移 |
| 文件大小 | 小（几KB） | 中等（几十KB） |
| 导入方式 | 添加到现有配置 | 覆盖所有数据 |
| 安全性 | 较低（可分享） | 较高（包含敏感信息） |

## 技术支持

如果遇到问题，请：

1. 查看本文档的"常见问题"部分
2. 检查应用是否为最新版本
3. 尝试重启应用或设备
4. 联系技术支持并提供：
   - 设备型号和系统版本
   - 问题的详细描述
   - 错误提示信息（如果有）

## 更新日志

### v1.0.0 (2025-12-29)
- ✅ 新增移动端文件系统访问支持
- ✅ 支持Android/iOS WebView
- ✅ 自动存储权限管理
- ✅ 完整的数据备份和恢复功能
- ✅ 多平台兼容（原生应用、Web浏览器）
- ✅ 友好的错误提示和用户引导

## 下一步

- [ ] ZIP压缩支持（减小备份文件大小）
- [ ] 云存储集成（自动备份到云端）
- [ ] 数据加密（保护敏感信息）
- [ ] 增量备份（只备份变化部分）
- [ ] 备份版本管理（保留多个历史版本）

---

**提示**: 文件访问功能需要应用有适当的权限。如果遇到问题，请检查应用权限设置或参考本文档的"常见问题"部分。
