# 用户数据管理功能说明

## 功能概述

本次更新新增了用户数据管理专区，并优化了现有的配置导入导出功能，使其在移动端（Android和iOS）上能正常使用。

## 新增功能

### 1. 用户数据管理专区

位于用户配置管理页面底部，提供以下功能：

#### 📦 数据备份与恢复
- **完整数据备份**：一键备份所有用户数据，包括：
  - 用户配置（所有已创建的配置）
  - 八字缓存数据
  - 应用设置（主题、语言、用户偏好等）
- **恢复备份数据**：从备份文件恢复数据，支持：
  - 完整恢复所有数据
  - 页面自动刷新应用恢复的数据
  - 数据格式验证

#### ⚙️ 配置导入导出
- **导出用户配置**：仅导出配置数据，用于分享或迁移
- **导入用户配置**：从配置文件导入数据，添加到现有配置

#### 🗑️ 数据清理
- **清空所有数据**：一键清除所有用户数据（配置、缓存、设置）
- 清空前会提示确认
- 操作不可撤销

### 2. 移动端优化

#### 设备检测
- 自动检测设备类型（移动端/桌面端）
- 检测HTTPS环境（存储权限要求）
- 检测File System Access API支持情况

#### 存储权限处理
- 移动端自动请求存储权限
- 权限拒绝时友好提示："存储权限不足，请在浏览器设置中允许文件访问"
- 提供降级方案：当新API不可用时，自动使用传统方式

#### 文件保存优化
- **移动端（支持File System Access API）**：
  - 使用 `showSaveFilePicker` 选择保存位置
  - 用户可以自由选择保存到任意位置
  - 支持取消操作
  
- **桌面端/传统方式**：
  - 使用标准的下载方式
  - 文件自动下载到默认下载文件夹

#### 文件导入优化
- **移动端（支持File System Access API）**：
  - 使用 `showOpenFilePicker` 选择文件
  - 支持文件类型过滤
  - 支持取消操作
  
- **桌面端/传统方式**：
  - 使用传统的文件选择器
  - 保持向后兼容性

## 使用场景

### 场景1：定期备份数据
1. 打开用户配置管理页面
2. 滚动到"用户数据管理"专区
3. 点击"创建备份"按钮
4. 移动端：选择保存位置并确认
5. 桌面端：文件自动下载

### 场景2：更换设备迁移数据
1. 在旧设备上创建完整备份
2. 将备份文件传输到新设备（云盘、邮件等）
3. 在新设备上打开应用
4. 滚动到"用户数据管理"专区
5. 点击"恢复备份"按钮
6. 选择备份文件并确认
7. 页面自动刷新，数据恢复完成

### 场景3：分享配置给他人
1. 点击"导出用户配置"按钮
2. 保存配置文件
3. 将文件发送给他人
4. 他人点击"导入用户配置"按钮
5. 选择文件并导入

### 场景4：清空所有数据重新开始
1. 滚动到"数据清理"区域
2. 点击"清空所有数据"按钮
3. 确认操作
4. 所有数据被清除

## 技术实现

### 移动端兼容性
- 使用现代 File System Access API
- 提供传统降级方案
- 自动检测环境并选择最佳方式

### 错误处理
- 存储权限拒绝：友好提示用户允许权限
- 文件操作失败：详细的错误信息
- 数据格式错误：验证并提示

### 数据安全
- 备份文件包含导出时间和版本信息
- 数据格式验证防止损坏
- 清空前二次确认防止误操作

## 文件结构

```
backup.json
{
  "exportTime": "2024-01-15T10:30:00.000Z",
  "version": "1.0.0",
  "data": {
    "configs": {
      "count": 3,
      "items": [...]
    },
    "cache": {
      "count": 10,
      "items": {...}
    },
    "settings": {
      "theme": "dark",
      "language": "zh-CN"
    }
  }
}
```

## 浏览器兼容性

### 完全支持
- Chrome 86+ (Desktop)
- Edge 86+ (Desktop)
- Safari 15.2+ (iOS)
- Chrome Mobile 86+ (Android)

### 降级支持
- 旧版浏览器使用传统文件输入/下载方式
- 保持基本功能可用

## 注意事项

1. **移动端首次使用**：浏览器会请求存储权限，请允许以正常使用
2. **定期备份**：建议定期创建备份，防止数据丢失
3. **备份文件安全**：包含敏感信息，请妥善保管
4. **恢复前备份**：恢复数据前建议先备份当前数据
5. **HTTPS要求**：某些功能需要HTTPS环境

## 未来扩展

可扩展的功能方向：
- ZIP压缩备份（减少文件大小）
- 云存储集成（直接备份到云端）
- 增量备份（只备份变化部分）
- 自动备份（定期自动创建备份）
- 数据加密（保护敏感信息）
