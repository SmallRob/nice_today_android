# 用户数据管理功能测试指南

## 测试环境要求

### 移动端测试
- Android设备（推荐Chrome 86+）
- iOS设备（推荐Safari 15.2+）
- 确保应用运行在HTTPS环境（用于测试File System Access API）

### 桌面端测试
- Chrome/Edge 86+
- Safari 15.2+
- Firefox 90+

## 功能测试清单

### 1. 数据管理专区UI测试

#### 1.1 组件加载
- [ ] 页面正常显示"用户数据管理"专区
- [ ] 所有按钮状态正常（非禁用状态）
- [ ] 提示信息正确显示

#### 1.2 响应式布局
- [ ] 桌面端：显示为2列网格布局
- [ ] 移动端：显示为单列布局
- [ ] 所有按钮和文本清晰可读

### 2. 完整数据备份测试

#### 2.1 移动端测试
**前置条件**：在移动设备上测试
- [ ] 点击"创建备份"按钮
- [ ] 系统弹出文件保存选择器
- [ ] 可以选择保存位置
- [ ] 文件保存成功
- [ ] 显示"备份成功"提示及数据大小
- [ ] 检查生成的backup.json文件内容格式正确
- [ ] 备份文件包含：exportTime, version, data
- [ ] data包含：configs, cache, settings

**测试权限拒绝**：
- [ ] 第一次保存时，查看权限请求提示
- [ ] 拒绝权限时，显示"存储权限不足"错误
- [ ] 拒绝后降级到传统下载方式

#### 2.2 桌面端测试
**前置条件**：在桌面浏览器测试
- [ ] 点击"创建备份"按钮
- [ ] 文件自动下载
- [ ] 文件命名为：nice-today-backup-{date}.json
- [ ] 显示"备份成功"提示
- [ ] 检查下载文件内容

#### 2.3 按钮状态测试
- [ ] 点击后显示加载状态（动画+处理中...）
- [ ] 处理过程中按钮禁用
- [ ] 处理完成后恢复可用状态

### 3. 恢复备份数据测试

#### 3.1 移动端测试
**前置条件**：已有有效的backup.json文件
- [ ] 点击"恢复备份"按钮
- [ ] 系统弹出文件选择器
- [ ] 可以选择backup.json文件
- [ ] 文件读取成功
- [ ] 显示"数据恢复成功"提示
- [ ] 页面自动刷新（2秒后）
- [ ] 刷新后数据正确恢复

**测试权限拒绝**：
- [ ] 拒绝权限时，显示"存储权限不足"错误
- [ ] 拒绝后降级到传统input方式

**测试文件格式错误**：
- [ ] 选择非JSON文件，显示格式错误
- [ ] 选择格式错误的JSON，显示格式错误

**测试取消操作**：
- [ ] 在文件选择器中取消
- [ ] 显示"已取消恢复"提示
- [ ] 不执行任何操作

#### 3.2 桌面端测试
- [ ] 点击"恢复备份"按钮
- [ ] 传统文件选择器弹出
- [ ] 选择backup.json文件
- [ ] 文件读取并恢复成功
- [ ] 页面自动刷新

### 4. 配置导出测试

#### 4.1 移动端测试
- [ ] 点击"导出配置"按钮
- [ ] 系统弹出文件保存选择器
- [ ] 可以选择保存位置
- [ ] 文件保存成功
- [ ] 显示"配置已保存到选择的位置"提示
- [ ] 文件命名为：nice-today-configs-{date}.json
- [ ] 导出文件包含所有配置数据

#### 4.2 桌面端测试
- [ ] 点击"导出配置"按钮
- [ ] 文件自动下载
- [ ] 文件命名正确
- [ ] 显示"配置导出成功"提示

### 5. 配置导入测试

#### 5.1 移动端测试
**前置条件**：已有有效的配置JSON文件
- [ ] 点击"导入配置"按钮
- [ ] 系统弹出文件选择器
- [ ] 可以选择配置文件
- [ ] 文件读取成功
- [ ] 显示"导入配置成功"提示
- [ ] 配置添加到现有配置列表

**测试文件格式错误**：
- [ ] 选择非JSON文件，显示格式错误
- [ ] 选择格式错误的JSON，显示格式错误

**测试取消操作**：
- [ ] 在文件选择器中取消
- [ ] 显示"已取消选择"提示

#### 5.2 桌面端测试
- [ ] 点击"导入配置"按钮
- [ ] 传统文件选择器弹出
- [ ] 选择配置文件
- [ ] 文件读取并导入成功
- [ ] 配置显示在列表中

### 6. 清空所有数据测试

#### 6.1 确认对话框
- [ ] 点击"清空所有数据"按钮
- [ ] 显示确认对话框："确定要清空所有用户数据吗？此操作不可撤销！"
- [ ] 对话框样式醒目（红色警告）

#### 6.2 执行清空
- [ ] 点击确认后清空数据
- [ ] 显示"所有数据已清空，页面将自动刷新"提示
- [ ] 页面自动刷新（1.5秒后）
- [ ] 刷新后：
  - [ ] localStorage中的userConfigs被清除
  - [ ] localStorage中的baziCache被清除
  - [ ] localStorage中的theme被清除
  - [ ] localStorage中的language被清除
  - [ ] localStorage中的userPreferences被清除

#### 6.3 取消清空
- [ ] 在确认对话框中点击取消
- [ ] 不执行任何操作
- [ ] 数据保持不变

### 7. 设备检测测试

#### 7.1 移动端设备
**测试设备**：Android/iOS
- [ ] 正确识别为移动设备
- [ ] 优先使用File System Access API
- [ ] API不可用时降级到传统方式

#### 7.2 桌面端设备
**测试设备**：Windows/macOS/Linux
- [ ] 正确识别为桌面设备
- [ ] 使用传统的文件选择/下载方式
- [ ] 所有功能正常工作

### 8. 错误处理测试

#### 8.1 存储权限不足
- [ ] 拒绝存储权限
- [ ] 显示"存储权限不足"错误
- [ ] 错误信息友好明确
- [ ] 不导致应用崩溃

#### 8.2 文件读写错误
- [ ] 选择损坏的JSON文件
- [ ] 捕获错误并显示友好提示
- [ ] 不影响应用其他功能

#### 8.3 HTTPS环境检测
- [ ] 非HTTPS环境下提示权限问题
- [ ] 降级到传统方式并继续工作

### 9. 数据完整性测试

#### 9.1 备份文件验证
创建备份后验证：
- [ ] 文件大小合理（通常几KB到几十KB）
- [ ] JSON格式有效
- [ ] 包含所有必需字段：
  - exportTime
  - version
  - data.configs
  - data.cache
  - data.settings

#### 9.2 数据恢复验证
恢复备份后验证：
- [ ] 所有配置正确恢复
- [ ] 缓存数据正确恢复
- [ ] 设置正确恢复
- [ ] 数据无丢失

### 10. 跨设备测试

#### 10.1 移动端→移动端
- [ ] 设备A创建备份
- [ ] 传输文件到设备B
- [ ] 设备B恢复备份
- [ ] 数据完整迁移

#### 10.2 桌面端→移动端
- [ ] 桌面端创建备份
- [ ] 传输文件到移动端
- [ ] 移动端恢复备份
- [ ] 数据完整迁移

#### 10.3 移动端→桌面端
- [ ] 移动端创建备份
- [ ] 传输文件到桌面端
- [ ] 桌面端恢复备份
- [ ] 数据完整迁移

## 性能测试

### 11. 响应时间测试
- [ ] 创建备份：响应时间 < 3秒
- [ ] 恢复备份：响应时间 < 5秒
- [ ] 导出配置：响应时间 < 2秒
- [ ] 导入配置：响应时间 < 3秒

### 12. 大文件处理
**测试场景**：创建包含多个配置的备份
- [ ] 10个配置的备份：创建时间 < 5秒
- [ ] 10个配置的恢复：恢复时间 < 7秒
- [ ] 文件大小合理（< 100KB）

## 兼容性测试

### 13. 浏览器兼容性

#### 13.1 Chrome/Edge 86+
- [ ] 所有功能正常
- [ ] File System Access API正常工作
- [ ] 降级方案正常工作

#### 13.2 Safari 15.2+
- [ ] 所有功能正常
- [ ] File System Access API正常工作（如支持）
- [ ] 降级方案正常工作

#### 13.3 Firefox 90+
- [ ] 所有功能正常
- [ ] 使用降级方案
- [ ] 用户体验良好

### 14. 屏幕尺寸测试

#### 14.1 小屏幕（< 375px）
- [ ] 布局适配良好
- [ ] 所有按钮可点击
- [ ] 文本清晰可读

#### 14.2 中等屏幕（375px - 768px）
- [ ] 布局适配良好
- [ ] 用户体验良好

#### 14.3 大屏幕（> 768px）
- [ ] 布局充分利用空间
- [ ] 2列网格布局正常

## 用户体验测试

### 15. 提示信息测试
- [ ] 所有操作都有相应的提示
- [ ] 成功提示使用绿色
- [ ] 错误提示使用红色
- [ ] 信息提示使用蓝色
- [ ] 警告提示使用黄色

### 16. 加载状态测试
- [ ] 处理中按钮显示加载动画
- [ ] 加载动画流畅
- [ ] 按钮在加载时禁用

### 17. 操作流畅性
- [ ] 按钮点击响应迅速
- [ ] 文件操作没有明显延迟
- [ ] 页面刷新平滑

## 回归测试

### 18. 原有功能测试
- [ ] 添加新配置功能正常
- [ ] 编辑配置功能正常
- [ ] 删除配置功能正常
- [ ] 切换配置功能正常
- [ ] 八字显示正常
- [ ] 姓名评分功能正常

## 已知问题记录

### 问题1：[描述]
- **影响范围**：[哪些功能]
- **触发条件**：[如何触发]
- **临时解决方案**：[如何绕过]
- **优先级**：[高/中/低]
- **状态**：[待修复/已修复]

## 测试总结

### 测试通过情况
- 总测试项：[数量]
- 通过：[数量]
- 失败：[数量]
- 通过率：[百分比]%

### 阻塞问题
列出阻碍发布的关键问题：
1. [问题描述]
2. [问题描述]

### 建议改进
1. [改进建议]
2. [改进建议]

## 测试环境记录

**测试日期**：[YYYY-MM-DD]
**测试人员**：[姓名]
**测试设备**：[设备列表]
**浏览器版本**：[版本信息]
**网络环境**：[WiFi/移动数据]
**备注**：[其他说明]
