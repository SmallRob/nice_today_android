# 能量树页面设计方案

## 一、功能概述

能量树是一个游戏化的能量收集和成长系统，通过日常使用APP积累能量，培育能量树成长。

## 二、核心功能

### 2.1 能量获取机制
1. **每日签到**：打开APP奖励100能量（每日首次打开）
2. **功能访问**：访问任何功能页面+50能量
3. **当日能量值**：每日自动获得首页能量球的能量值(例如今日能量值80，则当日获得80能量)
4. **能量提升页面能量**：打开能量提升页面+100能量，完成能量提升任务获得对应能量UP+能量，最多1000UP
3. **每日上限**：每日最多获得1300能量

### 2.2 能量气泡系统
- 保留3天内的能量气泡
- 气泡在能量树上随机生成
- 点击气泡收集能量
- 气泡有不同大小和能量值

### 2.3 能量树成长系统
- 能量达到一定级别自动升级
- 升级后树苗长大
- 不同等级有不同外观
- 升级奖励和特效

### 2.4 能量等级系统
```
等级 1-5:   种子阶段 (需要 0-500 能量)
等级 6-10:  幼苗阶段 (需要 500-2000 能量)
等级 11-20: 小树阶段 (需要 2000-10000 能量)
等级 21-30: 成树阶段 (需要 10000-30000 能量)
等级 31+:   古树阶段 (需要 30000+ 能量)
```

## 三、UI设计

### 3.1 页面布局
```
┌─────────────────────────────┐
│  能量树                    │  标题栏
├─────────────────────────────┤
│  [能量进度条]               │  能量显示
│  今日: 300/1500            │
│  总计: 12500                │
├─────────────────────────────┤
│                             │
│        🌳 能量树            │  中心树木
│      ●   ●   ●             │  能量气泡
│         ●                   │
│                             │
├─────────────────────────────┤
│  升级进度                   │  升级信息
│  当前等级: Lv.15             │
│  下一级: 5000/8000          │
├─────────────────────────────┤
│  能量记录                   │  能量历史
│  今日收集: 300              │
│  昨日收集: 800              │
│  前日收集: 600              │
└─────────────────────────────┘
```

### 3.2 视觉元素
- **能量树**：SVG绘制，根据等级变化外观
- **能量气泡**：浮动动画，点击收集
- **能量进度条**：渐变色彩，显示今日获取
- **等级徽章**：显示当前等级
- **升级特效**：粒子动画，闪光效果

### 3.3 交互设计
- 点击气泡收集能量，显示+100动画
- 能量树升级时触发特效动画
- 气泡自动生成和消失
- 长按树苗显示详细信息

## 四、技术实现

### 4.1 文件结构
```
frontend/src/
├── pages/
│   └── EnergyTreePage.js          # 能量树主页面
│   └── EnergyTreePage.css         # 能量树样式
├── components/
│   └── energy-tree/
│       ├── EnergyTree.js           # 能量树组件
│       ├── EnergyBubble.js         # 能量气泡组件
│       ├── EnergyProgressBar.js    # 能量进度条
│       ├── LevelBadge.js          # 等级徽章
│       └── EnergyHistory.js        # 能量历史记录
├── contexts/
│   └── EnergyContext.js          # 能量管理Context
├── utils/
│   └── energyCalculator.js       # 能量计算工具
└── constants/
    └── energyLevels.js           # 能量等级配置
```

### 4.2 数据存储
```javascript
// localStorage存储结构
{
  "energyData": {
    "totalEnergy": 12500,           // 总能量
    "currentLevel": 15,             // 当前等级
    "dailyCollected": 300,          // 今日收集
    "dailyLimit": 1500,             // 每日上限
    "lastOpenDate": "2025-01-02",  // 上次打开日期
    "bubbles": [                    // 能量气泡列表
      {
        "id": 1,
        "energy": 100,
        "x": 50,
        "y": 30,
        "size": "large",
        "createdAt": "2025-01-02T10:00:00",
        "expiresAt": "2025-01-05T10:00:00"
      }
    ],
    "history": [                     // 历史记录
      {
        "date": "2025-01-02",
        "collected": 300
      },
      {
        "date": "2025-01-01",
        "collected": 800
      }
    ]
  }
}
```

## 五、开发计划

### Phase 1: 基础框架 (Day 1)
- [ ] 创建 EnergyTreePage 页面结构
- [ ] 创建 EnergyContext 上下文
- [ ] 实现基本数据存储和读取
- [ ] 设计基础UI布局

### Phase 2: 能量树组件 (Day 2)
- [ ] 实现 EnergyTree 组件（SVG绘制）
- [ ] 实现不同等级的树外观
- [ ] 添加能量树生长动画
- [ ] 实现等级徽章组件

### Phase 3: 能量气泡系统 (Day 3)
- [ ] 实现 EnergyBubble 组件
- [ ] 添加气泡浮动动画
- [ ] 实现气泡生成逻辑
- [ ] 实现气泡过期机制（3天）
- [ ] 添加点击收集交互

### Phase 4: 能量管理系统 (Day 4)
- [ ] 实现每日签到逻辑
- [ ] 实现功能访问奖励
- [ ] 实现每日上限控制
- [ ] 实现能量历史记录
- [ ] 添加能量进度条组件

### Phase 5: 升级系统 (Day 5)
- [ ] 实现等级计算逻辑
- [ ] 添加升级触发机制
- [ ] 实现升级特效动画
- [ ] 添加升级奖励系统

### Phase 6: 优化和测试 (Day 6)
- [ ] 性能优化（动画、渲染）
- [ ] 深色模式适配
- [ ] 移动端适配
- [ ] 单元测试
- [ ] 集成测试

## 六、优先级

### P0 (必须完成)
- 基础页面布局
- 能量树显示
- 能量气泡收集
- 每日签到奖励

### P1 (重要功能)
- 功能访问奖励
- 每日上限控制
- 等级系统
- 升级动画

### P2 (增强功能)
- 能量历史记录
- 能量气泡自动生成
- 升级奖励
- 特效动画

### P3 (可选功能)
- 多种树木样式
- 季节主题
- 成就系统
- 社交分享

## 七、数据流设计

```
┌─────────────┐
│   APP启动   │
└──────┬──────┘
       │
       ▼
┌─────────────────┐
│ 检查今日签到   │
│ 首次打开+100   │
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│  访问功能页面   │
│  每次访问+100   │
│  (达上限停止)   │
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│ 能量树页面      │
│ - 显示树和气泡   │
│ - 收集气泡能量   │
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│  更新能量总数   │
│  检查升级条件   │
│  保存到本地存储  │
└─────────────────┘
```

## 八、注意事项

1. **性能优化**：
   - 气泡使用虚拟滚动或限制数量
   - 动画使用CSS transform
   - 避免频繁的localStorage读写

2. **数据安全**：
   - 防止作弊（修改时间等）
   - 数据验证和容错
   - 定期备份

3. **用户体验**：
   - 首次使用引导
   - 清晰的能量获取提示
   - 升级时的视觉反馈

4. **扩展性**：
   - 预留成就系统接口
   - 预留社交功能接口
   - 可配置的能量规则
