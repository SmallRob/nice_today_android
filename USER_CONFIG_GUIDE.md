# 用户配置系统实现说明

## 概述

根据要求，我们已经实现了以下功能：

1. **移除日期输入字段** - 从首页（生物节律）和玛雅出生图中移除了日期选择器
2. **创建全局配置管理系统** - 实现了用户配置的统一管理
3. **添加用户配置模块** - 在设置页面新增了用户配置管理界面
4. **优化启动加载** - 在应用启动时自动加载用户配置

## 核心文件

### 1. 用户配置管理器
**文件**: `frontend/src/utils/userConfigManager.js`

这是全局配置管理的核心，提供了：
- 默认配置模板
- 多组配置支持
- 配置的增删改查
- 本地存储同步
- 配置变更通知
- 配置导入/导出功能

默认配置示例：
```javascript
const DEFAULT_CONFIG = {
  nickname: '叉子',
  birthDate: '1991-04-30',
  zodiac: '金牛座',
  zodiacAnimal: '羊'
};
```

### 2. 用户配置界面组件
**文件**: `frontend/src/components/UserConfigManager.js`

提供直观的用户界面：
- 配置列表展示
- 可折叠/展开的配置表单
- 添加新配置
- 删除配置（保留至少一个）
- 设置当前使用配置
- 导入/导出配置

### 3. 修改的组件

#### BiorhythmTab.js
- 移除了日期输入字段
- 从用户配置管理器获取出生日期
- 显示用户昵称和配置信息

#### MayaBirthChart.js
- 移除了日期选择器组件
- 从用户配置管理器获取出生日期
- 显示用户信息，包括昵称、星座和生肖
- 添加"切换配置"按钮，直接跳转到设置页面

#### SettingsPage.js
- 添加了标签页界面
- 新增"用户配置"标签
- 集成了UserConfigManager组件

#### App.js
- 在应用启动时初始化用户配置管理器

## 工作流程

1. **应用启动**:
   - App.js 中初始化 userConfigManager
   - 加载本地存储的配置
   - 设置默认配置（如果没有保存的配置）

2. **配置获取**:
   - 生物节律和玛雅出生图组件监听配置变更
   - 自动使用当前配置的信息

3. **配置管理**:
   - 用户在设置页面的"用户配置"标签管理配置
   - 所有变更自动保存到本地存储
   - 配置变更通知其他组件更新

## 技术细节

### 数据存储
配置存储在浏览器的 localStorage 中，使用以下键名：
- `nice_today_user_configs`: 存储所有配置
- `nice_today_active_config_index`: 存储当前激活的配置索引

### 配置监听
实现了发布-订阅模式，组件可以注册监听器，在配置变更时自动更新：
```javascript
const removeListener = userConfigManager.addListener(({
  configs,
  activeConfigIndex,
  currentConfig
}) => {
  // 处理配置变更
});
```

### 性能优化
- 使用 useCallback 和 useMemo 避免不必要的重渲染
- 延迟加载配置管理器，避免阻塞应用启动
- 配置变更时只更新受影响的组件

## 使用说明

1. **查看当前配置**:
   - 在设置页面的"用户配置"标签中可以看到当前激活的配置

2. **添加新配置**:
   - 点击"添加新配置"按钮
   - 填写昵称、出生日期、星座和生肖
   - 点击"保存"

3. **切换配置**:
   - 展开配置项
   - 点击"设为当前配置"按钮
   - 或者点击"切换配置"按钮（在玛雅出生图页面）

4. **编辑配置**:
   - 展开配置项
   - 修改信息
   - 点击"保存"

5. **删除配置**:
   - 展开配置项
   - 点击"删除"按钮（至少保留一个配置）

6. **导出/导入**:
   - 点击"导出配置"下载配置文件
   - 点击"导入配置"选择配置文件上传

## 注意事项

1. 至少保留一个配置
2. 配置中的出生日期格式为 YYYY-MM-DD
3. 星座和生肖选项是预定义的列表
4. 配置变更会自动保存到本地存储
5. 在应用启动时会自动加载配置管理器

构建命令:
```bash
cd frontend
npm run build
```

构建成功，应用已经准备好部署。