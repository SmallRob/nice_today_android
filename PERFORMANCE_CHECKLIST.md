# 玛雅日历应用性能检查清单

## 使用前检查

### 1. 应用优化版本

- [ ] 运行 `./switch_to_optimized.sh` 应用优化版本
- [ ] 确认备份已创建
- [ ] 验证文件已正确替换

### 2. 构建配置优化

- [ ] 确保在生产模式下构建应用
  - React Native: `npx react-native run-android --variant=release`
  - React Web: `npm run build`
- [ ] 启用Hermes引擎 (Android)
  - 检查 `android/app/build.gradle` 中 `enableHermes: true`
- [ ] 移除console.log语句 (生产环境)
  - 检查Babel配置中包含 `transform-remove-console`

## 性能测试

### 1. 初始加载测试

- [ ] 测量应用启动时间 (从点击图标到界面可用)
- [ ] 测量玛雅日历页面加载时间
- [ ] 验证懒加载组件正确工作
- [ ] 检查初始内存使用情况

### 2. 渲染性能测试

- [ ] 测试玛雅日历界面滚动流畅度
- [ ] 测试玛雅出生图结果分块渲染
- [ ] 检查日期切换时的响应时间
- [ ] 验证组件记忆化是否生效 (使用React DevTools)

### 3. 内存使用测试

- [ ] 监控内存使用情况
- [ ] 检查是否存在内存泄漏
  - 多次切换页面
  - 长时间使用应用
  - 检查内存是否持续增长
- [ ] 验证定时器和事件监听器正确清理

### 4. 交互性能测试

- [ ] 测试日期选择器响应速度
- [ ] 测试快速切换日期的防抖效果
- [ ] 测试历史记录加载性能
- [ ] 测试网络请求取消功能

## 使用DevTools分析

### 1. React DevTools Profiler

- [ ] 使用Profiler记录组件渲染
- [ ] 检查不必要的重渲染
- [ ] 验证memo和useMemo是否有效
- [ ] 分析组件渲染时间

### 2. Chrome DevTools Performance

- [ ] 记录性能分析
- [ ] 检查主线程阻塞情况
- [ ] 分析JavaScript执行时间
- [ ] 检查布局和绘制性能

### 3. Flipper (React Native)

- [ ] 使用Flipper监控应用性能
- [ ] 检查网络请求性能
- [ ] 分析布局性能
- [ ] 检查崩溃情况

## 用户体验评估

### 1. 加载体验

- [ ] 初始加载是否感觉流畅
- [ ] 懒加载组件是否平滑过渡
- [ ] 加载状态指示是否清晰

### 2. 交互体验

- [ ] 日期选择是否响应迅速
- [ ] 页面切换是否流畅
- [ ] 长列表滚动是否平滑
- [ ] 动画是否流畅

### 3. 稳定性

- [ ] 应用是否稳定运行
- [ ] 是否有崩溃或卡顿
- [ ] 内存使用是否稳定
- [ ] 电池消耗是否合理

## 设备测试

### 1. 低端设备测试

- [ ] 在低RAM设备上测试
- [ ] 在低CPU设备上测试
- [ ] 在旧版本Android上测试
- [ ] 检查是否降级 gracefully

### 2. 高端设备测试

- [ ] 在高端设备上测试
- [ ] 检查是否能充分利用硬件性能
- [ ] 测试高分辨率屏幕适配

## 性能指标目标

### 1. 加载时间

- [ ] 应用启动时间 < 3秒
- [ ] 玛雅日历页面加载 < 2秒
- [ ] 组件切换 < 500ms

### 2. 渲染性能

- [ ] 60fps 滚动性能
- [ ] 主线程阻塞时间 < 16ms
- [ ] JavaScript执行时间 < 100ms

### 3. 内存使用

- [ ] 内存峰值 < 设备可用内存的30%
- [ ] 内存增长 < 5MB/小时
- [ ] 无明显内存泄漏

## 问题排查

### 1. 渲染卡顿

- [ ] 检查是否有不必要的重渲染
- [ ] 优化昂贵的计算
- [ ] 减少DOM节点数量
- [ ] 优化CSS选择器

### 2. 内存问题

- [ ] 检查定时器和监听器清理
- [ ] 优化大对象存储
- [ ] 检查闭包导致的内存泄漏
- [ ] 使用适当的缓存策略

### 3. 加载缓慢

- [ ] 优化图片资源
- [ ] 减少包体积
- [ ] 优化API请求
- [ ] 使用适当的缓存

## 记录结果

### 性能数据记录

| 测试项目 | 优化前 | 优化后 | 改进幅度 |
|---------|--------|--------|----------|
| 应用启动时间 | | | |
| 页面加载时间 | | | |
| 内存峰值 | | | |
| 滚动帧率 | | | |
| 交互响应时间 | | | |

### 设备测试记录

| 设备型号 | Android版本 | RAM | 测试结果 |
|---------|------------|-----|----------|
| | | | |
| | | | |
| | | | |

## 持续优化

### 1. 定期性能检查

- [ ] 每月进行一次性能评估
- [ ] 监控崩溃率和ANR
- [ ] 收集用户反馈
- [ ] 跟踪性能指标趋势

### 2. 代码审查清单

- [ ] 新组件是否使用memo优化
- [ ] 是否正确使用useMemo和useCallback
- [ ] 是否正确清理副作用
- [ ] 是否避免不必要的计算

通过遵循此检查清单，你可以确保玛雅日历应用的性能优化效果，并及时发现和解决潜在的性能问题。